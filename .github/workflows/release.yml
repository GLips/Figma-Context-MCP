# Originally inspired by create-t3-app
# https://github.com/t3-oss/create-t3-app/blob/main/.github/workflows/release.yml

name: Release

on:
  push:
    branches:
      - main

jobs:
  release:
    if: ${{ github.repository_owner == 'GLips' }}
    name: Create a PR for release workflow
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - uses: ./.github/actions/setup
        with:
          python-version: '3.9' # Specify Python version for the setup action

      - name: Check for errors
        run: pytest python_mcp/tests/

      - name: Build the package
        run: python -m build --sdist --wheel --outdir dist ./python_mcp
        # Ensure ./python_mcp is the correct path to the directory containing pyproject.toml

      - name: Python Package Built Notification
        run: echo "Python package built. Manual versioning and PyPI publishing required."

      - name: List built artifacts
        run: ls -R dist/

      - name: Upload distribution artifacts
        uses: actions/upload-artifact@v3
        with:
          name: python-package-dists
          path: dist/
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # GITHUB_TOKEN is usually available by default
